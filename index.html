<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#000000">
    <title>ðŸŽ® AR Tap Game - Make Monsters Laugh! ðŸ˜„</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘¾</text></svg>">

    <!-- A-Frame + MindAR -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%; height: 100%; overflow: hidden;
            background: #000; font-family: 'Comic Neue', cursive;
            touch-action: manipulation;
        }
        
        a-scene { 
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; z-index: 1; 
        }
        
        /* Game UI */
        #gameUI {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
        }
        
        #scorePanel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0,0,0,0.7); color: #FFD166;
            padding: 15px; border-radius: 20px; font-size: 1.4em;
            font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        #tapCounter {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0,0,0,0.7); color: #FF6F61;
            padding: 15px; border-radius: 20px; font-size: 1.4em;
            font-weight: bold;
        }
        
        #instructions {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); color: white; padding: 25px;
            border-radius: 20px; text-align: center; font-size: 1.3em;
            line-height: 1.5; max-width: 300px;
        }
        
        .gameBtn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(45deg, #FF6F61, #FF9E6D); color: white;
            border: none; border-radius: 50px; padding: 16px 32px;
            font-size: 1.3em; font-weight: bold; cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4); pointer-events: auto;
            font-family: 'Comic Neue', cursive; min-width: 200px;
        }
        
        .gameBtn:active { transform: translateX(-50%) scale(0.95); }
        
        /* Click effects */
        .click-effect {
            position: absolute; width: 80px; height: 80px;
            background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, rgba(255,215,0,0) 70%);
            border-radius: 50%; pointer-events: none; z-index: 100;
            animation: clickAnim 0.6s ease-out forwards;
        }
        
        @keyframes clickAnim {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        /* Monster reaction animations */
        @keyframes monsterHappy {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-5deg); }
            50% { transform: scale(1.3) rotate(5deg); }
            75% { transform: scale(1.2) rotate(-3deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        @keyframes monsterJump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .monster-happy { animation: monsterHappy 0.8s ease; }
        .monster-jump { animation: monsterJump 0.5s ease; }
        
        /* Floating tap icons */
        .tap-icon {
            position: absolute; width: 60px; height: 60px;
            background: rgba(255,255,255,0.9); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5em; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer; pointer-events: auto; z-index: 20;
            animation: floatTap 2s ease-in-out infinite;
        }
        
        @keyframes floatTap {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }
    </style>

    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Game UI -->
    <div id="gameUI">
        <div id="scorePanel">ðŸŒŸ Score: <span id="score">0</span></div>
        <div id="tapCounter">ðŸ‘† Taps: <span id="taps">0</span></div>
        <div id="instructions">
            <div style="font-size: 2em; margin-bottom: 10px;">ðŸŽ®</div>
            <div>Find markers and tap on monsters to make them laugh!</div>
            <div style="color: #FFD166; margin-top: 10px; font-size: 0.9em;">Each monster has unique sound!</div>
        </div>
        <button id="startBtn" class="gameBtn">ðŸŽ¯ Start Tapping!</button>
        <button id="restartBtn" class="gameBtn" style="display: none;">ðŸ”„ Play Again!</button>
    </div>

    <!-- AR Scene -->
    <a-scene
        mindar-image="imageTargetSrc: ./7-targets.mind; autoStart: false;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        embedded
    >
        <a-assets timeout="45000">
            <audio id="bg-music" src="./bg-music.mp3" preload="auto"></audio>
            <audio id="click-sound" src="./click-sound.mp3" preload="auto"></audio>
            <!-- Monster sounds -->
            <audio id="boo1" src="./boo1.mp3" preload="auto"></audio>
            <audio id="boo2" src="./boo2.mp3" preload="auto"></audio>
            <audio id="boo3" src="./boo3.mp3" preload="auto"></audio>
            <audio id="boo4" src="./boo4.mp3" preload="auto"></audio>
            <audio id="boo5" src="./boo5.mp3" preload="auto"></audio>
            <audio id="boo6" src="./boo6.mp3" preload="auto"></audio>
            <audio id="boo7" src="./boo7.mp3" preload="auto"></audio>
            
            <img id="logo1" src="./logo1.png" crossorigin="anonymous">
            <img id="logo2" src="./logo2.png" crossorigin="anonymous">
            <img id="logo3" src="./logo3.png" crossorigin="anonymous">
            <img id="logo4" src="./logo4.png" crossorigin="anonymous">
            <img id="logo5" src="./logo5.png" crossorigin="anonymous">
            <img id="logo6" src="./logo6.png" crossorigin="anonymous">
            <img id="logo7" src="./logo7.png" crossorigin="anonymous">
        </a-assets>

        <a-camera look-controls="enabled: false" position="0 0 0" wasd-controls="enabled:false"></a-camera>

        <!-- Interactive Monster targets -->
        <a-entity mindar-image-target="targetIndex: 0" class="monster-target">
            <a-image src="#logo1" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo1">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 1" class="monster-target">
            <a-image src="#logo2" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo2">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 2" class="monster-target">
            <a-image src="#logo3" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo3">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 3" class="monster-target">
            <a-image src="#logo4" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo4">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 4" class="monster-target">
            <a-image src="#logo5" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo5">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 5" class="monster-target">
            <a-image src="#logo6" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo6">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 6" class="monster-target">
            <a-image src="#logo7" position="0 0 0" scale="1 1 1" class="clickable-monster" data-sound="boo7">
                <a-animation attribute="rotation" to="0 360 0" dur="8000" repeat="indefinite" easing="linear"></a-animation>
            </a-image>
        </a-entity>
    </a-scene>

    <script>
        // Game state
        const gameState = {
            score: 0,
            totalTaps: 0,
            gameActive: false,
            activeMonsters: new Map(), // Map of active monster elements
            monsterSounds: ['boo1', 'boo2', 'boo3', 'boo4', 'boo5', 'boo6', 'boo7'],
            monsterNames: ['Giggly Ghost', 'Funny Frankenstein', 'Silly Skeleton', 
                          'Jolly Jack-o-Lantern', 'Happy Haunter', 'Chuckling Creature', 
                          'Laughing Monster']
        };

        // DOM elements
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const scoreDisplay = document.getElementById('score');
        const tapsDisplay = document.getElementById('taps');
        const instructions = document.getElementById('instructions');

        // Start game
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);

        function startGame() {
            gameState.score = 0;
            gameState.totalTaps = 0;
            gameState.gameActive = true;
            gameState.activeMonsters.clear();
            
            scoreDisplay.textContent = '0';
            tapsDisplay.textContent = '0';
            startBtn.style.display = 'none';
            restartBtn.style.display = 'none';
            instructions.style.display = 'none';
            
            // Start AR
            const scene = document.querySelector('a-scene');
            const mindarSystem = scene.systems["mindar-image-system"];
            if (mindarSystem) {
                mindarSystem.start();
            }
            
            // Enable audio
            enableAudio();
        }

        // Monster interaction system
        document.querySelector('a-scene').addEventListener('loaded', () => {
            const targets = document.querySelectorAll('a-entity[mindar-image-target]');
            
            targets.forEach((target, index) => {
                let tapIcon = null;
                
                target.addEventListener('targetFound', () => {
                    if (!gameState.gameActive) return;
                    
                    // Create tap icon for this monster
                    const monsterImg = target.querySelector('a-image');
                    if (monsterImg && !gameState.activeMonsters.has(index)) {
                        createTapIcon(target, index);
                    }
                });

                target.addEventListener('targetLost', () => {
                    // Remove tap icon when target is lost
                    if (tapIcon) {
                        tapIcon.remove();
                        tapIcon = null;
                        gameState.activeMonsters.delete(index);
                    }
                });
                
                // Add click listener to the monster image
                const monsterImg = target.querySelector('a-image');
                if (monsterImg) {
                    monsterImg.addEventListener('click', (e) => {
                        if (!gameState.gameActive) return;
                        
                        handleMonsterTap(target, index, e);
                    });
                }
            });
        });

        function createTapIcon(target, monsterIndex) {
            const tapIcon = document.createElement('div');
            tapIcon.className = 'tap-icon';
            tapIcon.innerHTML = 'ðŸ‘†';
            tapIcon.style.color = '#FF6F61';
            tapIcon.title = `Tap ${gameState.monsterNames[monsterIndex]}!`;
            
            // Position near the monster (this is approximate)
            const x = 50 + (monsterIndex * 10);
            const y = 20 + (monsterIndex * 5);
            tapIcon.style.left = `${x}%`;
            tapIcon.style.top = `${y}%`;
            
            document.getElementById('gameUI').appendChild(tapIcon);
            gameState.activeMonsters.set(monsterIndex, tapIcon);
            
            // Click on tap icon also triggers monster reaction
            tapIcon.addEventListener('click', () => {
                handleMonsterTap(target, monsterIndex);
            });
        }

        function handleMonsterTap(target, monsterIndex, event = null) {
            if (!gameState.gameActive) return;
            
            const monsterImg = target.querySelector('a-image');
            if (!monsterImg) return;
            
            // Add visual feedback
            if (event) {
                createClickEffect(event.clientX, event.clientY);
            }
            
            // Monster reaction animation
            monsterImg.classList.add('monster-happy');
            setTimeout(() => {
                monsterImg.classList.remove('monster-happy');
            }, 800);
            
            // Play unique monster sound
            const soundId = gameState.monsterSounds[monsterIndex];
            playSound(soundId);
            
            // Update score
            gameState.score += 10;
            gameState.totalTaps++;
            scoreDisplay.textContent = gameState.score;
            tapsDisplay.textContent = gameState.totalTaps;
            
            // Bonus for multiple quick taps
            if (gameState.totalTaps % 5 === 0) {
                showBonusMessage('+50 Bonus! ðŸŽ‰');
                gameState.score += 50;
                scoreDisplay.textContent = gameState.score;
            }
            
            // Play click sound
            playSound('click-sound');
        }

        function createClickEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = `${x - 40}px`;
            effect.style.top = `${y - 40}px`;
            document.getElementById('gameUI').appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 600);
        }

        function showBonusMessage(text) {
            const bonus = document.createElement('div');
            bonus.textContent = text;
            bonus.style.position = 'absolute';
            bonus.style.top = '40%';
            bonus.style.left = '50%';
            bonus.style.transform = 'translateX(-50%)';
            bonus.style.color = '#FFD166';
            bonus.style.fontSize = '1.5em';
            bonus.style.fontWeight = 'bold';
            bonus.style.background = 'rgba(0,0,0,0.8)';
            bonus.style.padding = '10px 20px';
            bonus.style.borderRadius = '15px';
            bonus.style.zIndex = '100';
            
            document.getElementById('gameUI').appendChild(bonus);
            
            setTimeout(() => {
                bonus.remove();
            }, 1500);
        }

        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('Sound play failed:', e));
            }
        }

        function enableAudio() {
            const bgMusic = document.getElementById('bg-music');
            if (bgMusic) {
                bgMusic.muted = false;
                bgMusic.volume = 0.2;
                bgMusic.loop = true;
                bgMusic.play().catch(e => console.log('Music play failed'));
            }
        }

        // Auto-start after user interaction
        document.body.addEventListener('click', () => {
            if (!gameState.gameActive) {
                startBtn.style.display = 'block';
            }
        }, { once: true });
    </script>
</body>
</html>
