<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>üéÆ AR Monster Party - Interactive Fun! üéâ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëæ</text></svg>">

    <!-- A-Frame + MindAR (–±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤!) -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%; height: 100%; overflow: hidden;
            background: #000; font-family: 'Comic Neue', cursive;
            touch-action: manipulation;
        }
        
        a-scene { 
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; z-index: 2; 
            background: transparent !important;
        }
        
        /* Scanning Overlay */
        #scanningOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            color: #FFD166;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            z-index: 999;
            pointer-events: none;
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }
        
        #scanningOverlay.scanning {
            display: flex;
        }
        
        /* Game UI */
        #gameUI {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
        }
        
        #scorePanel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0,0,0,0.7); color: #FFD166;
            padding: 15px; border-radius: 20px; font-size: 1.4em;
            font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }
        
        #tapCounter {
            position: absolute; top: 20px; right: 20px;
            background: rgba(0,0,0,0.7); color: #FF6F61;
            padding: 15px; border-radius: 20px; font-size: 1.4em;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }
        
        /* Control buttons */
        .control-btn {
            position: absolute;
            background: rgba(0,0,0,0.7); 
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5em;
            cursor: pointer;
            pointer-events: auto;
            z-index: 20;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .control-btn:active {
            transform: scale(0.9);
        }
        
        #soundBtn {
            bottom: 100px;
            right: 20px;
            background: rgba(255,215,102,0.9);
        }
        
        #stopBtn {
            bottom: 20px;
            right: 20px;
            background: rgba(239,71,111,0.9);
        }
        
        #soundBtn.muted {
            background: rgba(128,128,128,0.7);
            opacity: 0.7;
        }
        
        #instructions {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); color: white; padding: 25px;
            border-radius: 20px; text-align: center; font-size: 1.3em;
            line-height: 1.5; max-width: 300px;
            backdrop-filter: blur(15px);
            border: 2px solid #FFD166;
        }
        
        .gameBtn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(45deg, #FF6F61, #FF9E6D); color: white;
            border: none; border-radius: 50px; padding: 16px 32px;
            font-size: 1.3em; font-weight: bold; cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4); pointer-events: auto;
            font-family: 'Comic Neue', cursive; min-width: 200px;
            backdrop-filter: blur(10px);
        }
        
        .gameBtn:active { transform: translateX(-50%) scale(0.95); }
        
        #iosMessage {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: #FFD166;
            padding: 15px 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.1em;
            display: none;
            backdrop-filter: blur(10px);
            border: 2px solid #FF6F61;
            max-width: 80%;
            z-index: 30;
        }
        
        /* Monster icons */
        .tap-icon {
            position: absolute; width: 80px; height: 80px;
            background: rgba(255,255,255,0.95); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2em; box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            cursor: pointer; pointer-events: auto; z-index: 20;
            border: 3px solid;
            animation: floatTap 2s ease-in-out infinite;
        }
        
        .tap-icon-0 { border-color: #FF6F61; background: rgba(255,111,97,0.9); }
        .tap-icon-1 { border-color: #FFD166; background: rgba(255,209,102,0.9); }
        .tap-icon-2 { border-color: #06D6A0; background: rgba(6,214,160,0.9); }
        .tap-icon-3 { border-color: #118AB2; background: rgba(17,138,178,0.9); }
        .tap-icon-4 { border-color: #EF476F; background: rgba(239,71,111,0.9); }
        .tap-icon-5 { border-color: #9B5DE5; background: rgba(155,93,229,0.9); }
        .tap-icon-6 { border-color: #00BBF9; background: rgba(0,187,249,0.9); }
        
        @keyframes floatTap {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            25% { transform: translateY(-15px) rotate(-5deg) scale(1.05); }
            50% { transform: translateY(-20px) rotate(5deg) scale(1.1); }
            75% { transform: translateY(-10px) rotate(-3deg) scale(1.05); }
        }
        
        .click-effect {
            position: absolute; width: 80px; height: 80px;
            border-radius: 50%; pointer-events: none; z-index: 100;
            animation: clickAnim 0.8s ease-out forwards;
        }
        
        .click-effect-0 { background: radial-gradient(circle, rgba(255,111,97,0.8) 0%, transparent 70%); }
        .click-effect-1 { background: radial-gradient(circle, rgba(255,209,102,0.8) 0%, transparent 70%); }
        .click-effect-2 { background: radial-gradient(circle, rgba(6,214,160,0.8) 0%, transparent 70%); }
        .click-effect-3 { background: radial-gradient(circle, rgba(17,138,178,0.8) 0%, transparent 70%); }
        .click-effect-4 { background: radial-gradient(circle, rgba(239,71,111,0.8) 0%, transparent 70%); }
        .click-effect-5 { background: radial-gradient(circle, rgba(155,93,229,0.8) 0%, transparent 70%); }
        .click-effect-6 { background: radial-gradient(circle, rgba(0,187,249,0.8) 0%, transparent 70%); }
        
        @keyframes clickAnim {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        .monster-dance { animation: monsterDance 1s ease; }
        @keyframes monsterDance {
            0% { transform: scale(1) rotate(0deg) translateY(0); }
            25% { transform: scale(1.2) rotate(-10deg) translateY(-10px); }
            50% { transform: scale(1.3) rotate(10deg) translateY(-15px); }
            75% { transform: scale(1.1) rotate(-5deg) translateY(-5px); }
            100% { transform: scale(1) rotate(0deg) translateY(0); }
        }
    </style>

    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Scanning Overlay -->
    <div id="scanningOverlay">
        <div style="font-size: 2em; margin-bottom: 15px;">üîç</div>
        <div>Point camera at the coloring page...</div>
        <div style="font-size: 0.8em; margin-top: 10px; color: #FF6F61;">
            Make sure it's well-lit and steady!
        </div>
    </div>

    <!-- Game UI -->
    <div id="gameUI">
        <div id="scorePanel">üåü Score: <span id="score">0</span></div>
        <div id="tapCounter">üëÜ Taps: <span id="taps">0</span></div>
        
        <button id="soundBtn" class="control-btn" title="Sound On/Off">üîä</button>
        <button id="stopBtn" class="control-btn" title="Stop Game" style="display: none;">‚èπÔ∏è</button>
        
        <div id="iosMessage">
            üì± iOS Tips:<br>
            ‚Ä¢ Good lighting required<br>
            ‚Ä¢ Hold phone steady<br>
            ‚Ä¢ Point directly at markers<br>
            ‚Ä¢ Move slowly
        </div>
        
        <div id="instructions">
            <div style="font-size: 2em; margin-bottom: 10px;">üéÆ</div>
            <div>Find markers and tap colorful icons!</div>
            <div style="color: #FFD166; margin-top: 10px; font-size: 0.9em;">
                Each color = different monster & sound!
            </div>
        </div>
        <button id="startBtn" class="gameBtn">üéØ Start Monster Party!</button>
        <button id="restartBtn" class="gameBtn" style="display: none;">üîÑ Play Again!</button>
    </div>

    <!-- AR Scene -->
    <a-scene
        mindar-image="imageTargetSrc: ./7-targets.mind; 
                      filterMinCF: 0.0005; 
                      filterBetaCF: 0.005; 
                      warmupTolerance: 10; 
                      missTolerance: 5; 
                      maxTrack: 3;
                      uiScanning: #scanningOverlay; 
                      uiLoading: no;
                      autoStart: false;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        embedded
    >
        <a-assets timeout="60000">
            <!-- Monster sounds -->
            <audio id="boo1" src="./boo1.mp3" preload="auto"></audio>
            <audio id="boo2" src="./boo2.mp3" preload="auto"></audio>
            <audio id="boo3" src="./boo3.mp3" preload="auto"></audio>
            <audio id="boo4" src="./boo4.mp3" preload="auto"></audio>
            <audio id="boo5" src="./boo5.mp3" preload="auto"></audio>
            <audio id="boo6" src="./boo6.mp3" preload="auto"></audio>
            <audio id="boo7" src="./boo7.mp3" preload="auto"></audio>
            
            <img id="logo1" src="./logo1.png" crossorigin="anonymous">
            <img id="logo2" src="./logo2.png" crossorigin="anonymous">
            <img id="logo3" src="./logo3.png" crossorigin="anonymous">
            <img id="logo4" src="./logo4.png" crossorigin="anonymous">
            <img id="logo5" src="./logo5.png" crossorigin="anonymous">
            <img id="logo6" src="./logo6.png" crossorigin="anonymous">
            <img id="logo7" src="./logo7.png" crossorigin="anonymous">
        </a-assets>

        <a-camera 
            look-controls="enabled: false" 
            position="0 0 0" 
            wasd-controls="enabled:false"
        ></a-camera>

        <!-- Monsters with modern animation -->
        <a-entity mindar-image-target="targetIndex: 0" class="monster-target">
            <a-image src="#logo1" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo1"
                animation__rot="property: rotation; to: 0 360 0; dur: 8000; loop: true; easing: linear"
                animation__pos="property: position; to: 0 0.1 0; dur: 2000; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
        <a-entity mindar-image-target="targetIndex: 1" class="monster-target">
            <a-image src="#logo2" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo2"
                animation__rot="property: rotation; to: 360 0 0; dur: 7000; loop: true; easing: linear"
                animation__scale="property: scale; to: 1.4 1.4 1.4; dur: 1500; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
        <a-entity mindar-image-target="targetIndex: 2" class="monster-target">
            <a-image src="#logo3" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo3"
                animation__rot="property: rotation; to: 0 0 360; dur: 6000; loop: true; easing: linear"
                animation__pos="property: position; to: 0.1 0 0; dur: 1800; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
        <a-entity mindar-image-target="targetIndex: 3" class="monster-target">
            <a-image src="#logo4" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo4"
                animation__rot="property: rotation; to: 0 360 360; dur: 9000; loop: true; easing: linear"
                animation__scale="property: scale; to: 1.0 1.0 1.0; dur: 2200; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
        <a-entity mindar-image-target="targetIndex: 4" class="monster-target">
            <a-image src="#logo5" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo5"
                animation__rot="property: rotation; to: 360 360 0; dur: 7500; loop: true; easing: linear"
                animation__pos="property: position; to: 0 0.15 0; dur: 2500; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
        <a-entity mindar-image-target="targetIndex: 5" class="monster-target">
            <a-image src="#logo6" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo6"
                animation__rot="property: rotation; to: 0 180 360; dur: 8500; loop: true; easing: linear"
                animation__scale="property: scale; to: 1.5 1.5 1.5; dur: 1900; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
        <a-entity mindar-image-target="targetIndex: 6" class="monster-target">
            <a-image src="#logo7" position="0 0 0" scale="1.2 1.2 1.2" class="clickable-monster" data-sound="boo7"
                animation__rot="property: rotation; to: 360 0 360; dur: 6800; loop: true; easing: linear"
                animation__pos="property: position; to: -0.1 0.1 0; dur: 2100; loop: true; dir: alternate; easing: easeInOutSine">
            </a-image>
        </a-entity>
    </a-scene>

    <script>
        const gameState = {
            score: 0,
            totalTaps: 0,
            gameActive: false,
            soundEnabled: true,
            activeMonsters: new Map(),
            monsterSounds: ['boo1', 'boo2', 'boo3', 'boo4', 'boo5', 'boo6', 'boo7'],
            monsterNames: ['Red Giggler', 'Yellow Chuckler', 'Green Laugher', 
                          'Blue Snicker', 'Pink Giggler', 'Purple Chuckle', 
                          'Blue Laugher'],
            monsterColors: ['#FF6F61', '#FFD166', '#06D6A0', '#118AB2', '#EF476F', '#9B5DE5', '#00BBF9']
        };

        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const stopBtn = document.getElementById('stopBtn');
        const soundBtn = document.getElementById('soundBtn');
        const scoreDisplay = document.getElementById('score');
        const tapsDisplay = document.getElementById('taps');
        const instructions = document.getElementById('instructions');
        const iosMessage = document.getElementById('iosMessage');
        const scanningOverlay = document.getElementById('scanningOverlay');

        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        }

        soundBtn.addEventListener('click', toggleSound);
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            if (gameState.soundEnabled) {
                soundBtn.innerHTML = 'üîä';
                soundBtn.classList.remove('muted');
            } else {
                soundBtn.innerHTML = 'üîá';
                soundBtn.classList.add('muted');
            }
        }

        stopBtn.addEventListener('click', stopGame);
        function stopGame() {
            if (!gameState.gameActive) return;
            gameState.gameActive = false;
            const scene = document.querySelector('a-scene');
            const mindarSystem = scene.systems["mindar-image-system"];
            if (mindarSystem?.stop) mindarSystem.stop();
            gameState.activeMonsters.forEach(icon => icon?.remove());
            gameState.activeMonsters.clear();
            alert(`üéä Game Finished!\nFinal Score: ${gameState.score}\nTotal Taps: ${gameState.totalTaps}`);
            restartBtn.style.display = 'block';
            stopBtn.style.display = 'none';
            soundBtn.style.display = 'none';
        }

        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);

        function startGame() {
            gameState.score = 0;
            gameState.totalTaps = 0;
            gameState.gameActive = true;
            gameState.activeMonsters.clear();
            scoreDisplay.textContent = '0';
            tapsDisplay.textContent = '0';
            startBtn.style.display = 'none';
            restartBtn.style.display = 'none';
            stopBtn.style.display = 'block';
            soundBtn.style.display = 'block';
            instructions.style.display = 'none';
            scanningOverlay.classList.add('scanning');

            // Show iOS tip
            if (isIOS()) {
                iosMessage.style.display = 'block';
                setTimeout(() => iosMessage.style.display = 'none', 5000);
            }

            // Start MindAR after scene is ready
            const scene = document.querySelector('a-scene');
            const startAR = () => {
                const mindarSystem = scene.systems["mindar-image-system"];
                if (mindarSystem && !mindarSystem.started) {
                    mindarSystem.start();
                    scanningOverlay.classList.remove('scanning');
                }
            };

            if (scene.hasLoaded) {
                startAR();
            } else {
                scene.addEventListener('loaded', startAR, { once: true });
            }
        }

        // Monster interaction
        document.querySelector('a-scene').addEventListener('loaded', () => {
            const targets = document.querySelectorAll('a-entity[mindar-image-target]');
            let foundCount = 0;

            targets.forEach((target, index) => {
                target.addEventListener('targetFound', () => {
                    foundCount++;
                    if (!gameState.gameActive) return;
                    if (!gameState.activeMonsters.has(index)) {
                        createTapIcon(target, index);
                        const img = target.querySelector('a-image');
                        if (img) img.classList.add('active-monster');
                        if (foundCount === 1) scanningOverlay.classList.remove('scanning');
                    }
                });

                target.addEventListener('targetLost', () => {
                    const icon = gameState.activeMonsters.get(index);
                    if (icon) {
                        icon.remove();
                        gameState.activeMonsters.delete(index);
                        const img = target.querySelector('a-image');
                        if (img) img.classList.remove('active-monster');
                    }
                });

                const img = target.querySelector('a-image');
                if (img) {
                    img.addEventListener('click', () => {
                        if (gameState.gameActive && gameState.activeMonsters.has(index)) {
                            handleMonsterTap(target, index);
                        }
                    });
                }
            });
        });

        function createTapIcon(target, index) {
            const tapIcon = document.createElement('div');
            tapIcon.className = `tap-icon tap-icon-${index}`;
            const emojis = ['üëª', 'üéÉ', 'üòà', 'ü¶á', 'üêâ', 'üëΩ', 'ü§°'];
            tapIcon.innerHTML = emojis[index];
            const positions = [
                { left: '10%', top: '20%' }, { left: '80%', top: '25%' },
                { left: '15%', top: '70%' }, { left: '75%', top: '65%' },
                { left: '45%', top: '15%' }, { left: '55%', top: '75%' },
                { left: '25%', top: '45%' }
            ];
            const pos = positions[index] || { left: '50%', top: '50%' };
            tapIcon.style.left = pos.left;
            tapIcon.style.top = pos.top;
            tapIcon.title = `${gameState.monsterNames[index]} - Click me!`;
            document.getElementById('gameUI').appendChild(tapIcon);
            gameState.activeMonsters.set(index, tapIcon);
            tapIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                handleMonsterTap(target, index);
            });
        }

        function handleMonsterTap(target, index) {
            const img = target.querySelector('a-image');
            if (!img) return;

            // Visual feedback
            img.classList.add('monster-dance');
            setTimeout(() => img.classList.remove('monster-dance'), 1000);

            // Sound
            if (gameState.soundEnabled) {
                const sound = document.getElementById(gameState.monsterSounds[index]);
                if (sound) {
                    sound.currentTime = 0;
                    sound.volume = 0.7;
                    sound.play().catch(e => console.log("Sound play failed:", e));
                }
            }

            // Scoring
            const points = 10 + (index + 1) * 2;
            gameState.score += points;
            gameState.totalTaps++;
            scoreDisplay.textContent = gameState.score;
            tapsDisplay.textContent = gameState.totalTaps;

            if (gameState.totalTaps % 7 === 0) {
                gameState.score += 77;
                scoreDisplay.textContent = gameState.score;
            }
        }

        // Ensure user interaction before audio
        document.body.addEventListener('click', () => {
            if (!gameState.gameActive) startBtn.style.display = 'block';
        }, { once: true });
    </script>
</body>
</html>
