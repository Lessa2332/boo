<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>üéÆ AR Monster Party - iOS Debug</title>
    
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            width: 100%; height: 100%; overflow: hidden; 
            background: #000; font-family: 'Comic Neue', cursive;
        }
        
        #videoBackground {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            object-fit: cover; z-index: 0;
        }
        
        a-scene { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 2; background: transparent !important; 
        }
        
        /* Scanning Overlay */
        #scanningOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            color: #FFD166;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            z-index: 999;
            pointer-events: none;
            flex-direction: column;
            text-align: center;
        }
        
        #scanningOverlay.scanning {
            display: flex;
        }
        
        #gameUI {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
        }
        
        .gameBtn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #FF6F61; color: white; border: none; border-radius: 50px; 
            padding: 16px 32px; font-size: 1.3em; cursor: pointer; pointer-events: auto;
            font-family: 'Comic Neue', cursive;
        }
        
        #debugInfo {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: #00FF00;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9em;
            max-width: 80%;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <video id="videoBackground" autoplay muted playsinline></video>

    <!-- Scanning Overlay -->
    <div id="scanningOverlay">
        <div style="font-size: 2em; margin-bottom: 15px;">üîç</div>
        <div>–®—É–∫–∞—î–º–æ –º–∞—Ä–∫–µ—Ä–∏...</div>
        <div style="font-size: 0.8em; margin-top: 10px; color: #FF6F61;">
            –ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ —Ä–æ–∑–º–∞–ª—å–æ–≤–∫—É
        </div>
    </div>

    <div id="gameUI">
        <div id="debugInfo">
            –°—Ç–∞—Ç—É—Å: <span id="debugStatus">–ì–æ—Ç–æ–≤–∏–π</span>
        </div>
        <button id="startBtn" class="gameBtn">üéÆ –°—Ç–∞—Ä—Ç AR –ì—Ä–∏</button>
    </div>

    <!-- –û–ù–û–í–õ–ï–ù–ê AR-–°–¶–ï–ù–ê –î–õ–Ø iOS -->
    <a-scene
        mindar-image="imageTargetSrc: ./7-targets.mind; 
                      filterMinCF: 0.0005; 
                      filterBetaCF: 0.005; 
                      warmupTolerance: 10; 
                      missTolerance: 5; 
                      maxTrack: 3;
                      uiScanning: #scanningOverlay; 
                      uiLoading: no;
                      autoStart: false;"
        embedded
        renderer="colorManagement: true"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
    >
        <a-assets timeout="60000">
            <img id="logo1" src="./logo1.png" crossorigin="anonymous">
            <img id="logo2" src="./logo2.png" crossorigin="anonymous">
            <img id="logo3" src="./logo3.png" crossorigin="anonymous">
            <img id="logo4" src="./logo4.png" crossorigin="anonymous">
            <img id="logo5" src="./logo5.png" crossorigin="anonymous">
            <img id="logo6" src="./logo6.png" crossorigin="anonymous">
            <img id="logo7" src="./logo7.png" crossorigin="anonymous">
        </a-assets>

        <a-camera look-controls="enabled: false" position="0 0 0"></a-camera>

        <!-- 7 –º–∞—Ä–∫–µ—Ä—ñ–≤ –∑ –¥–µ–±–∞–≥-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ -->
        <a-entity mindar-image-target="targetIndex: 0">
            <a-image src="#logo1" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="0 360 0" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 1">
            <a-image src="#logo2" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="360 0 0" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 2">
            <a-image src="#logo3" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="0 0 360" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 3">
            <a-image src="#logo4" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="0 360 360" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 4">
            <a-image src="#logo5" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="360 360 0" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 5">
            <a-image src="#logo6" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="0 180 360" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
        
        <a-entity mindar-image-target="targetIndex: 6">
            <a-image src="#logo7" position="0 0 0" scale="0.5 0.5 0.5">
                <a-animation attribute="rotation" to="360 0 360" dur="5000" repeat="indefinite"></a-animation>
            </a-image>
        </a-entity>
    </a-scene>

    <script>
        const startBtn = document.getElementById('startBtn');
        const videoBackground = document.getElementById('videoBackground');
        const scanningOverlay = document.getElementById('scanningOverlay');
        const debugStatus = document.getElementById('debugStatus');

        function updateDebugStatus(status) {
            debugStatus.textContent = status;
            console.log(`üîß ${status}`);
        }

        // iOS camera fix
        async function initializeIOS() {
            try {
                updateDebugStatus('–ó–∞–ø–∏—Ç –∫–∞–º–µ—Ä–∏...');
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                videoBackground.srcObject = stream;
                updateDebugStatus('–ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞');
                
                // –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
                scanningOverlay.classList.add('scanning');
                
                setTimeout(() => {
                    const scene = document.querySelector('a-scene');
                    const mindarSystem = scene.systems["mindar-image-system"];
                    if (mindarSystem) {
                        mindarSystem.start();
                        updateDebugStatus('AR –∑–∞–ø—É—â–µ–Ω–æ - —à—É–∫–∞—î–º–æ –º–∞—Ä–∫–µ—Ä–∏');
                        console.log('üöÄ iOS AR Started');
                        
                        // –°—Ö–æ–≤–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫
                        setTimeout(() => {
                            scanningOverlay.classList.remove('scanning');
                        }, 5000);
                    }
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå iOS Camera Error:', error);
                updateDebugStatus('–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏');
                alert('üì∑ –î–æ–∑–≤–æ–ª—å –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ —Ç–∞ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂ —Å—Ç–æ—Ä—ñ–Ω–∫—É');
            }
        }

        startBtn.addEventListener('click', initializeIOS);
        
        // –î–µ—Ç–µ–∫—Ç iOS
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent);
        }
        
        // –î–æ–¥–∞—î–º–æ –¥–µ–±–∞–≥-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –º–∞—Ä–∫–µ—Ä—ñ–≤
        document.querySelector('a-scene').addEventListener('loaded', () => {
            console.log('‚úÖ AR Scene loaded');
            updateDebugStatus('–°—Ü–µ–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞');
            
            const targets = document.querySelectorAll('a-entity[mindar-image-target]');
            console.log(`üéØ Found ${targets.length} AR targets`);
            
            targets.forEach((target, index) => {
                target.addEventListener('targetFound', () => {
                    console.log(`üéØ FOUND TARGET ${index}!`);
                    alert(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –º–∞—Ä–∫–µ—Ä ${index + 1}!`); // –¢–ò–ú–ß–ê–°–û–í–û
                    updateDebugStatus(`–ó–Ω–∞–π–¥–µ–Ω–æ –º–∞—Ä–∫–µ—Ä ${index + 1}`);
                    
                    // –°—Ö–æ–≤–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—ñ –ø–µ—Ä—à–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
                    if (index === 0) {
                        scanningOverlay.classList.remove('scanning');
                    }
                });

                target.addEventListener('targetLost', () => {
                    console.log(`‚ùå LOST TARGET ${index}`);
                    updateDebugStatus(`–í—Ç—Ä–∞—á–µ–Ω–æ –º–∞—Ä–∫–µ—Ä ${index + 1}`);
                });
            });
        });

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
        console.log('üì± Device Info:', {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            isIOS: isIOS(),
            isHTTPS: window.location.protocol === 'https:',
            host: window.location.host
        });

        if (!isIOS()) {
            updateDebugStatus('Android/PC - –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏');
        }
    </script>
</body>
</html>
